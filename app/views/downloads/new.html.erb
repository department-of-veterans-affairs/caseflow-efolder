<div class="cf-app-segment cf-app-segment--alt ee-new-download">
  <div class="ee-heading">
    <h1>Welcome to eFolder Express!</h1>

    <p>
      eFolder Express allows VA employees to bulk-download VBMS eFolders.<br/>
      Search for a File Number below to get started.
    </p>
  </div>

  <% if @error == :veteran_not_found %>
    <p>
      <div class="usa-alert usa-alert-error" role="alert">
        <div class="usa-alert-body">
          <h3 class="usa-alert-heading">Couldn't find an eFolder with that ID</h3>
          <p class="usa-alert-text">
            It looks like there's no folder with this ID. Check to make sure you entered the ID correctly and try again.
          </p>
        </div>
      </div>
    </p>
  <% elsif @error == :access_denied %>
    <p>
      <div class="usa-alert usa-alert-error" role="alert">
        <div class="usa-alert-body">
          <h3 class="usa-alert-heading">You don't have permission to view this eFolderâ€‹</h3>
          <p class="usa-alert-text">
            It looks like you don't have permission to view this eFolder. This usually happens if the eFolder contains sensitive information.
          </p>
        </div>
      </div>
    </p>
  <% end %>

  <div class="ee-search">
    <%= form_for @download, method: :post, html: { class: "usa-search usa-search-big" } do %>
      <div role="search">
        <%= label_tag(:file_number, "Search for a VBMS eFolder to get started.", class: "usa-sr-only") %>
        <%= search_field_tag(:file_number) %>
        <button type="submit">
          <span class='usa-search-submit-text'>Search</span>
        </button>
      </div>
    <% end %>

    <p class="cf-txt-c">
      <em>Note: eFolder Express does not currently support Virtual VA documents.</em>
    </p>
  </div>

  <% if recent_downloads.exists? %>
    <h2 class="ee-recent-searches">Download History</h2>
    <table class="usa-table-borderless" summary="List of recent downloads and links to download their contents">
    <thead>
      <tr class="usa-sr-only">
        <th scope="col">File Number</th>
        <th scope="col">Actions</th>
      </tr>
    </thead>
    <tbody>
      <% recent_downloads.each do |download| %>
        <tr id="download-<%= download.id %>">
          <td>
            <%= download.veteran_name %>
            <span class="cf-subtext">(<%= download.file_number %>)</span>
          </td>
          <td class="ee-actions-cell">
            <% if download.pending_documents? %>
              <%= link_to "View Progress", download_path(download) %>
            <% else %>
              <%= link_to "View Results", download_path(download) %>
            <% end %>

            <% if download.complete_with_errors? %>
              <%= svg_icon(:alert) %>
            <% end %>
          </td>
        </tr>
      <% end %>
    </tbody>
    </table>
  <% end %>
</div>

